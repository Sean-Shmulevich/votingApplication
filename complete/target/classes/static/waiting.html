<!DOCTYPE html>
<html>
<head>
    <title>Hello WebSocket</title>
    <link href="/webjars/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/main.css" rel="stylesheet">
    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script src="/app.js"></script>
    <script>
        //when you page and come back this code will be executed and it allows for the question to be correct even if the user
        //goes to like check instagram or something after the question has already been posted
        document.onvisibilitychange = async function() {
            //i dont know or think i need this re-load.
            window.location.reload();
            if (document.visibilityState === 'hidden') {
                let q = await (await fetch("/getProjectNames")).json();
            let currentTime = q["questionNumber"];
            //only do anything really if the question is currently not been answered and the time is still not -1
            if(currentTime !== -1 && localStorage.getItem(`user-voted-${q["content"]}`) !== "true"){
                localStorage.setItem('currentQuestion', q["content"]);
                localStorage.setItem('currentTime', q["questionNumber"]);

                window.location.replace(`/question.html`);
            }
            }
        };
        window.addEventListener('load', (async () => {
        //on load check if there is a question I dont know if this code is necessary because you only ever get to waiting from a question and i dont want to do extra fetches
        let q = await (await fetch("/getProjectNames")).json();
        localStorage.setItem('currentQuestion', q["content"]);
        localStorage.setItem('currentTime', q["questionNumber"]);
            // let currentTime = q["questionNumber"];
            // if(currentTime !== -1 && localStorage.getItem(`user-voted-${q["content"]}`) !== "true"){
            //     localStorage.setItem('currentQuestion', q["content"]);
            //     localStorage.setItem('currentTime', q["questionNumber"]);
            //     window.location.reload();

            //     // window.location.replace(`/question.html`);
            // }
            console.log(localStorage.getItem("connected"), typeof(localStorage.getItem("connected")));
            // if(localStorage.getItem("connected") === "false"){
            //     localStorage.setItem("connected", true);
            //     console.log("here");
            //     window.location.reload();
            // }
        }));
    </script>
</head>
<body>
<noscript><h2 style="color: #ff0000">Seems your browser doesn't support Javascript! Websocket relies on Javascript being
    enabled. Please enable
    Javascript and reload this page!</h2></noscript>
<div id="main-content" class="container">
    <h1 style="text-align: center;font-size:3rem">Waiting for question</h1>
    <div class="row">
        <!-- <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <label for="connect">WebSocket connection:</label>
                    <button id="connect" class="btn btn-default" type="submit">Connect</button>`
                    <button id="disconnect" class="btn btn-default" type="submit" disabled="disabled">Disconnect
                    </button>
                </div>
            </form>
        </div> -->
        <!-- <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <label for="name">Enter your choice</label>
                    <input type="text" id="name" class="form-control" placeholder="Your name here...">
                </div>
                <button id="send" class="btn btn-default" type="submit">Send</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table id="conversation" class="table table-striped">
                <thead>
                <tr>
                    <th>Responses</th>
                </tr>
                </thead>
                <tbody id="sendQuestion">
                </tbody>
            </table>
        </div>
    </div> -->
</div>
</body>
</html>
